// db â€” flow-os
// Database nativo (SQLite locale, Postgres, etc.)

@native("flow_db_connect")
fn connect(url: str)

@native("flow_db_query")
fn query<T>(sql: str, params: any[]): T[]

@native("flow_db_exec")
fn exec(sql: str, params: any[]): int

@native("flow_db_transaction")
fn transaction(body: fn())

// Query builder
@native("flow_db_from")
fn from(table: str): QueryBuilder

type QueryBuilder {
    fn where(cond: str, params: any[]): QueryBuilder
    fn select(cols: str[]): QueryBuilder
    fn limit(n: int): QueryBuilder
    fn offset(n: int): QueryBuilder
    fn order(col: str, dir: "asc" | "desc"): QueryBuilder
    fn all<T>(): T[]
    fn one<T>(): ?T
    fn insert(data: map<str, any>): int
    fn update(data: map<str, any>): int
    fn delete(): int
}

// Uso:
//   db.connect("sqlite://local.db")
//   let users = db.from("users").where("active = ?", [true]).all<User>()
//   db.exec("INSERT INTO logs VALUES (?, ?)", [id, "login"])
